name: Benchmarks

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  micro-benchmarks:
    name: Vitest Micro-Benchmarks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm via corepack
        run: |
          corepack enable
          corepack prepare pnpm@10 --activate

      - run: pnpm install
      - run: pnpm build

      - name: Run micro-benchmarks
        run: pnpm bench
        working-directory: packages/core

  # NOTE: k6 tests are disabled in CI because they require a custom k6 build
  # with xk6-msgpack extension for MessagePack support.
  #
  # To run k6 tests locally:
  #   1. Build custom k6: pnpm test:k6:build
  #   2. Start server: pnpm start:server
  #   3. Run tests: pnpm test:k6:smoke (or other k6 test scripts)
  #
  # k6-smoke-test:
  #   name: k6 Smoke Test
  #   runs-on: ubuntu-latest
  #   ...
  #
  # k6-throughput-benchmark:
  #   name: k6 Throughput Benchmark
  #   runs-on: ubuntu-latest
  #   ...
