# TopGun

## What This Is

A hybrid offline-first in-memory data grid providing zero-latency reads/writes via local CRDTs, real-time sync via WebSockets, and durable storage on PostgreSQL.

## Core Value

Local-first data access that never waits for network, with automatic conflict resolution and seamless sync when connectivity is available.

## Tech Stack

| Layer | Technology |
|-------|------------|
| Language | TypeScript |
| Runtime | Node.js |
| Package Manager | pnpm 10.13.1 (monorepo) |
| Build Tool | tsup |
| Testing | Jest |
| Server Transport | WebSocket (ws) |
| Database | PostgreSQL |
| Serialization | msgpackr |
| Schema Validation | Zod |

## Project Structure

```
packages/
├── core/           # CRDTs (LWWMap, ORMap), HLC, MerkleTree, schemas
├── client/         # Browser/Node SDK: TopGunClient, SyncEngine
├── server/         # WebSocket server, clustering, PostgreSQL adapter
├── react/          # React bindings: hooks (useQuery, useMap, etc.)
├── adapters/       # Storage implementations (IndexedDB)
├── native/         # Native xxHash64 for Node.js performance
├── mcp-server/     # MCP server integration
└── adapter-better-auth/  # BetterAuth integration
tests/
├── e2e/            # End-to-end tests
└── k6/             # Load testing (k6)
```

## Patterns & Conventions

- Monorepo with package hierarchy: core -> client/server -> adapters/react
- TypeScript with strict mode
- Commit format: `type(scope): description` (feat, fix, docs, test, chore, refactor, perf)
- Test files co-located with source in `__tests__/` directories
- Server tests use ports 10000+ for servers, 11000+ for cluster nodes
- CRDTs use Hybrid Logical Clocks for causality tracking
- No phase/spec/bug references in code comments — use WHY-comments instead

## Constraints

- Local-first: Reads and writes must never wait for network
- CRDT conflict resolution using LWW-Map and OR-Map
- Must work offline with IndexedDB persistence
- Server-authoritative cluster architecture

---
*Generated by SpecFlow on 2026-01-20*
